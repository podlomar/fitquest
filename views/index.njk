<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fitness Tracker</title>
  <link rel="stylesheet" href="/styles.css">
</head>

<body>
  <div class="container">
    <header>
      <h1>üèÉ‚Äç‚ôÇÔ∏è Fitness Tracker</h1>
      <p>Your fitness journey at a glance</p>
      
      <!-- Success/Error Messages -->
      {% if success %}
        <div class="message success">‚úÖ Entry added successfully!</div>
      {% endif %}
      {% if error %}
        <div class="message error">‚ùå Error adding entry. Please try again.</div>
      {% endif %}
      
      <!-- Add Entry Button -->
      <button id="addEntryBtn" class="add-entry-btn">+ Add New Entry</button>
    </header>

    <!-- Add Entry Form (initially hidden) -->
    <div id="addEntryForm" class="form-container" style="display: none;">
      <div class="form-wrapper">
        <h2>Add New Fitness Entry</h2>
        <form action="/add-entry" method="POST">
          <div class="form-row">
            <div class="form-group">
              <label for="date">Date:</label>
              <input type="date" id="date" name="date" required>
            </div>
          </div>

          <div class="form-section">
            <h3>üèÉ‚Äç‚ôÇÔ∏è Running</h3>
            <div class="form-row">
              <div class="form-group">
                <label for="trackName">Track Name:</label>
                <input type="text" id="trackName" name="trackName" placeholder="e.g., Nuselsk√°">
              </div>
              <div class="form-group">
                <label for="trackLength">Length (km):</label>
                <input type="number" id="trackLength" name="trackLength" step="0.1" min="0" placeholder="4">
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="trackProgress">Progress:</label>
                <input type="text" id="trackProgress" name="trackProgress" placeholder="e.g., full, flight 6">
              </div>
              <div class="form-group">
                <label for="trackUrl">Track URL:</label>
                <input type="url" id="trackUrl" name="trackUrl" placeholder="http://example.com/track">
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="performance">Performance (1-5):</label>
                <select id="performance" name="performance">
                  <option value="none">None</option>
                  <option value="1">1 ‚≠ê</option>
                  <option value="2" selected>2 ‚≠ê‚≠ê</option>
                  <option value="3">3 ‚≠ê‚≠ê‚≠ê</option>
                  <option value="4">4 ‚≠ê‚≠ê‚≠ê‚≠ê</option>
                  <option value="5">5 ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</option>
                </select>
              </div>
            </div>
          </div>

          <div class="form-section">
            <h3>üí™ Workout</h3>
            <div class="form-row">
              <div class="form-group">
                <label for="workoutLevel">Level:</label>
                <select id="workoutLevel" name="workoutLevel">
                  <option value="low">Low</option>
                  <option value="mid" selected>Mid</option>
                  <option value="high">High</option>
                  <option value="base">Base</option>
                  <option value="off">Off</option>
                  <option value="rest">Rest</option>
                </select>
              </div>
              <div class="form-group">
                <label for="workoutContent">Content:</label>
                <input type="text" id="workoutContent" name="workoutContent" placeholder="e.g., 12d 8k">
              </div>
            </div>
          </div>

          <div class="form-section">
            <h3>üßò‚Äç‚ôÄÔ∏è Other Activities</h3>
            <div class="form-row">
              <div class="form-group">
                <label for="stretching">Stretching:</label>
                <select id="stretching" name="stretching">
                  <option value="true" selected>Yes ‚úì</option>
                  <option value="false">No ‚úó</option>
                </select>
              </div>
              <div class="form-group">
                <label for="stairsType">Stairs:</label>
                <select id="stairsType" name="stairsType" onchange="toggleStairsFields()">
                  <option value="data">Stairs Data</option>
                  <option value="away">Away</option>
                  <option value="none">None</option>
                </select>
              </div>
            </div>
            <div class="form-row" id="stairsFields">
              <div class="form-group">
                <label for="stairsFloors">Floors:</label>
                <input type="number" id="stairsFloors" name="stairsFloors" min="1" value="8">
              </div>
              <div class="form-group">
                <label for="stairsTime">Time (mm:ss):</label>
                <input type="text" id="stairsTime" name="stairsTime" placeholder="1:15" pattern="[0-9]+:[0-5][0-9]">
              </div>
            </div>
          </div>

          <div class="form-actions">
            <button type="submit" class="submit-btn">Save Entry</button>
            <button type="button" id="cancelBtn" class="cancel-btn">Cancel</button>
          </div>
        </form>
      </div>
    </div>

    <main>
      <!-- Summary Statistics -->
      <div class="summary-section">
        <div class="summary-cards">
          <div class="summary-card">
            <div class="summary-icon">üìÖ</div>
            <div class="summary-content">
              <div class="summary-number">{{ stats.totalDays }}</div>
              <div class="summary-label">Total Days</div>
            </div>
          </div>
          
          <div class="summary-card">
            <div class="summary-icon">üèÉ‚Äç‚ôÇÔ∏è</div>
            <div class="summary-content">
              <div class="summary-number">{{ stats.totalDistance }} km</div>
              <div class="summary-label">Total Distance</div>
            </div>
          </div>
          
          <div class="summary-card">
            <div class="summary-icon">üßò‚Äç‚ôÄÔ∏è</div>
            <div class="summary-content">
              <div class="summary-number">{{ stats.stretchingStreak }}</div>
              <div class="summary-label">Stretching Streak</div>
            </div>
          </div>
          
          <div class="summary-card">
            <div class="summary-icon">‚≠ê</div>
            <div class="summary-content">
              <div class="summary-number">{{ stats.avgPerformance if stats.avgPerformance > 0 else '-' }}</div>
              <div class="summary-label">Avg Performance</div>
            </div>
          </div>
          
          <div class="summary-card">
            <div class="summary-icon">üèÉ‚Äç‚ôÄÔ∏è</div>
            <div class="summary-content">
              <div class="summary-number">{{ stats.bestStairsTime if stats.bestStairsTime else '-' }}</div>
              <div class="summary-label">Best 8 Flights</div>
            </div>
          </div>
        </div>
      </div>

      <div class="table-wrapper">
        <table class="fitness-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Track</th>
              <th>Progress</th>
              <th>Performance</th>
              <th>Workout</th>
              <th>Stretching</th>
              <th>Stairs</th>
            </tr>
          </thead>
          <tbody>
            {% for entry in data %}
              <tr>
                <td data-label="Date">
                  {{ entry.date | formatDate }}
                </td>
                <td data-label="Track">
                  {% if entry.running and entry.running.track %}
                    {% if entry.running.track.url %}
                      <a href="{{ entry.running.track.url }}" target="_blank" class="track-link">
                        {{ entry.running.track.name }} ({{ entry.running.track.length }} km)
                      </a>
                    {% else %}
                      {{ entry.running.track.name }}
                    {% endif %}
                  {% else %}
                    -
                  {% endif %}
                </td>
                <td data-label="Progress">
                  {% if entry.running and entry.running.track and entry.running.track.progress %}
                    <span class="progress">
                      {{ entry.running.track.progress }}
                    </span>
                  {% else %}
                    -
                  {% endif %}
                </td>
                <td data-label="Performance">
                  {% if entry.running and entry.running.performance and entry.running.performance != 'none' %}
                    <div class="performance-rating">
                      {% for i in range(1, 6) %}
                        <span class="star {{ 'filled' if i <= entry.running.performance else '' }}">‚òÖ</span>
                      {% endfor %}
                    </div>
                  {% else %}
                    <span class="performance-none">-</span>
                  {% endif %}
                </td>
                <td data-label="Workout">
                  {% if entry.workout %}
                    {% if entry.workout == 'rest' %}
                      <span class="workout-rest">Rest</span>
                    {% elif entry.workout.level %}
                      <div class="workout-info">
                        <span class="level level-{{ entry.workout.level }}">
                          {{ entry.workout.level }}
                        </span>
                        {% if entry.workout.content %}
                          <div class="workout-content">
                            {{ entry.workout.content }}
                          </div>
                        {% endif %}
                      </div>
                    {% else %}
                      {{ entry.workout }}
                    {% endif %}
                  {% else %}
                    -
                  {% endif %}
                </td>
                <td data-label="Stretching">
                  <span class="status {{ 'yes' if entry.stretching else 'no' }}">
                    {{ '‚úì' if entry.stretching else '‚úó' }}
                  </span>
                </td>
                <td data-label="Stairs">
                  {% if entry.stairs %}
                    {% if entry.stairs == 'away' %}
                      <span class="stairs-away">Away</span>
                    {% elif entry.stairs == 'none' %}
                      <span class="stairs-none">-</span>
                    {% elif entry.stairs.floors %}
                      <div class="stairs-info">
                        <span class="stairs-floors">{{ entry.stairs.floors }} floors</span>
                        {% if entry.stairs.time %}
                          <span class="stairs-time">{{ entry.stairs.time }}</span>
                        {% endif %}
                      </div>
                    {% else %}
                      <span class="stairs">{{ entry.stairs }}</span>
                    {% endif %}
                  {% else %}
                    -
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      {% if data.length == 0 %}
        <div class="no-data">
          <p>No fitness data available</p>
        </div>
      {% endif %}
    </main>

    <footer>
      <p>Keep up the great work! üí™</p>
    </footer>
  </div>

  <script>
    // Set current date as default
    document.getElementById('date').value = new Date().toISOString().split('T')[0];

    // Toggle form visibility
    document.getElementById('addEntryBtn').addEventListener('click', function() {
      const form = document.getElementById('addEntryForm');
      form.style.display = form.style.display === 'none' ? 'block' : 'none';
      if (form.style.display === 'block') {
        form.scrollIntoView({ behavior: 'smooth' });
      }
    });

    // Cancel button
    document.getElementById('cancelBtn').addEventListener('click', function() {
      document.getElementById('addEntryForm').style.display = 'none';
    });

    // Toggle stairs fields based on selection
    function toggleStairsFields() {
      const stairsType = document.getElementById('stairsType').value;
      const stairsFields = document.getElementById('stairsFields');
      stairsFields.style.display = stairsType === 'data' ? 'flex' : 'none';
    }

    // Hide messages after 5 seconds
    setTimeout(function() {
      const messages = document.querySelectorAll('.message');
      messages.forEach(function(message) {
        message.style.display = 'none';
      });
    }, 5000);
  </script>
</body>

</html>
